import type { QRMode, QRVersion, ErrorCorrectionLevel } from '../types';

/**
 * QR 코드 인코딩 모드 지시자
 * ISO/IEC 18004 표 2 (line 497-509)
 */
export const MODE_INDICATORS = {
  numeric: '0001',
  alphanumeric: '0010',
  byte: '0100',
  kanji: '1000',
} as const;

/**
 * 영숫자 모드에서 사용 가능한 문자들
 * ISO/IEC 18004 표 5 (line 578-585)
 */
export const ALPHANUMERIC_CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:';

/**
 * QR 버전 상수 배열 (1부터 40까지)
 */
export const QR_VERSIONS = [
  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
  28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
] as const satisfies readonly QRVersion[];

/**
 * 버전별 문자 카운트 지시자 비트 수
 * ISO/IEC 18004 표 3 (line 512-559)
 */
export const CHARACTER_COUNT_BITS: Record<QRMode, Record<string, number>> = {
  numeric: { '1-9': 10, '10-26': 12, '27-40': 14 },
  alphanumeric: { '1-9': 9, '10-26': 11, '27-40': 13 },
  byte: { '1-9': 8, '10-26': 16, '27-40': 16 },
  kanji: { '1-9': 8, '10-26': 10, '27-40': 12 },
};

/**
 * 버전별 데이터 용량 테이블 (비트 단위)
 * ISO/IEC 18004 표 7-11 (line 617-729)
 */
export const DATA_CAPACITY_TABLE: Record<QRVersion, Record<ErrorCorrectionLevel, number>> = {
  1: { L: 152, M: 128, Q: 104, H: 72 },
  2: { L: 272, M: 224, Q: 176, H: 128 },
  3: { L: 440, M: 352, Q: 272, H: 208 },
  4: { L: 640, M: 512, Q: 384, H: 288 },
  5: { L: 864, M: 688, Q: 496, H: 368 },
  6: { L: 1088, M: 864, Q: 608, H: 480 },
  7: { L: 1248, M: 992, Q: 704, H: 528 },
  8: { L: 1552, M: 1232, Q: 880, H: 688 },
  9: { L: 1856, M: 1456, Q: 1056, H: 800 },
  10: { L: 2192, M: 1728, Q: 1232, H: 976 },
  11: { L: 2592, M: 2032, Q: 1440, H: 1120 },
  12: { L: 2960, M: 2320, Q: 1648, H: 1264 },
  13: { L: 3424, M: 2672, Q: 1952, H: 1440 },
  14: { L: 3688, M: 2920, Q: 2088, H: 1576 },
  15: { L: 4184, M: 3320, Q: 2360, H: 1784 },
  16: { L: 4712, M: 3624, Q: 2600, H: 2024 },
  17: { L: 5176, M: 4056, Q: 2936, H: 2264 },
  18: { L: 5768, M: 4504, Q: 3176, H: 2504 },
  19: { L: 6360, M: 5016, Q: 3560, H: 2728 },
  20: { L: 6888, M: 5352, Q: 3880, H: 3080 },
  21: { L: 7456, M: 5712, Q: 4096, H: 3248 },
  22: { L: 8048, M: 6256, Q: 4544, H: 3536 },
  23: { L: 8752, M: 6880, Q: 4912, H: 3712 },
  24: { L: 9392, M: 7312, Q: 5312, H: 4112 },
  25: { L: 10208, M: 8000, Q: 5744, H: 4304 },
  26: { L: 10960, M: 8496, Q: 6032, H: 4768 },
  27: { L: 11744, M: 9024, Q: 6464, H: 5024 },
  28: { L: 12248, M: 9544, Q: 6968, H: 5288 },
  29: { L: 13048, M: 10136, Q: 7288, H: 5608 },
  30: { L: 13880, M: 10984, Q: 7880, H: 5960 },
  31: { L: 14744, M: 11640, Q: 8264, H: 6344 },
  32: { L: 15640, M: 12328, Q: 8920, H: 6760 },
  33: { L: 16568, M: 13048, Q: 9368, H: 7208 },
  34: { L: 17528, M: 13800, Q: 9848, H: 7688 },
  35: { L: 18448, M: 14496, Q: 10288, H: 7888 },
  36: { L: 19472, M: 15312, Q: 10832, H: 8432 },
  37: { L: 20528, M: 15936, Q: 11408, H: 8768 },
  38: { L: 21616, M: 16816, Q: 12016, H: 9136 },
  39: { L: 22706, M: 17728, Q: 12656, H: 9776 },
  40: { L: 23856, M: 18672, Q: 13328, H: 10208 },
};

/**
 * 갈루아 필드 GF(256) 관련 상수
 * ISO/IEC 18004 부속서 A
 */
export const GALOIS_FIELD = {
  FIELD_SIZE: 256,
  PRIMITIVE_POLYNOMIAL: 0x11d, // x^8 + x^4 + x^3 + x^2 + 1
} as const;

/**
 * 패딩 패턴
 * ISO/IEC 18004 8.4.9 (line 865-881)
 */
export const PADDING_PATTERNS = {
  PAD_CODEWORD_1: 0xec, // 11101100
  PAD_CODEWORD_2: 0x11, // 00010001
} as const;

/**
 * 종단자 최대 길이
 */
export const TERMINATOR_MAX_LENGTH = 4;

/**
 * 버전별 잔여 비트 수
 * ISO/IEC 18004 표 1 (line 480)
 */
export const REMAINDER_BITS: number[] = [
  0,
  7,
  7,
  7,
  7,
  7,
  0,
  0,
  0,
  0, // 1-10
  0,
  0,
  0,
  3,
  3,
  3,
  3,
  3,
  3,
  3, // 11-20
  4,
  4,
  4,
  4,
  4,
  4,
  4,
  3,
  3,
  3, // 21-30
  3,
  3,
  3,
  3,
  0,
  0,
  0,
  0,
  0,
  0, // 31-40
];

/**
 * 얼라인먼트 패턴 위치 (버전별)
 * ISO/IEC 18004 Annex E - Alignment pattern center position
 * 모든 QR 버전 (1-40) 지원
 */
export const ALIGNMENT_PATTERN_POSITIONS: Record<number, number[]> = {
  1: [],
  2: [6, 18],
  3: [6, 22],
  4: [6, 26],
  5: [6, 30],
  6: [6, 34],
  7: [6, 22, 38],
  8: [6, 24, 42],
  9: [6, 26, 46],
  10: [6, 28, 50],
  11: [6, 30, 54],
  12: [6, 32, 58],
  13: [6, 34, 62],
  14: [6, 26, 46, 66],
  15: [6, 26, 48, 70],
  16: [6, 26, 50, 74],
  17: [6, 30, 54, 78],
  18: [6, 30, 56, 82],
  19: [6, 30, 58, 86],
  20: [6, 34, 62, 90],
  21: [6, 28, 50, 72, 94],
  22: [6, 26, 50, 74, 98],
  23: [6, 30, 54, 78, 102],
  24: [6, 28, 54, 80, 106],
  25: [6, 32, 58, 84, 110],
  26: [6, 30, 58, 86, 114],
  27: [6, 34, 62, 90, 118],
  28: [6, 26, 50, 74, 98, 122],
  29: [6, 30, 54, 78, 102, 126],
  30: [6, 26, 52, 78, 104, 130],
  31: [6, 30, 56, 82, 108, 134],
  32: [6, 34, 60, 86, 112, 138],
  33: [6, 30, 58, 86, 114, 142],
  34: [6, 34, 62, 90, 118, 146],
  35: [6, 30, 54, 78, 102, 126, 150],
  36: [6, 24, 50, 76, 102, 128, 154],
  37: [6, 28, 54, 80, 106, 132, 158],
  38: [6, 32, 58, 84, 110, 136, 162],
  39: [6, 26, 54, 82, 110, 138, 166],
  40: [6, 30, 58, 86, 114, 142, 170],
};
